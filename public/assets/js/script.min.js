/*! Oink 2018-08-24 */


document.addEventListener("DOMContentLoaded", function() {
    $(document).ready(function() {
        initBarba();
    });
});

function scrollMagic() {
    var controller = new ScrollMagic.Controller();
    var duration = .75;
    var animations = [ {
        x: 200,
        opacity: 1,
        height: 300
    }, {
        rotation: 360,
        opacity: 1
    }, {
        scale: .5,
        opacity: 1,
        x: 400
    } ];
    $("[data-scrollmagic]").each(function(index) {
        var tl = new TimelineMax();
        tl.to(this, duration, animations[index]);
        var scene = new ScrollMagic.Scene({
            triggerElement: this,
            triggerHook: .6,
            reverse: false
        }).setTween(tl).addIndicators().addTo(controller);
    });
}

function handleAnimations() {
    var Homepage = Barba.BaseView.extend({
        namespace: "homepage",
        onEnter: function() {
            console.log("enter");
            TweenMax.from("#main-content", 1, {
                delay: .5,
                x: "+=100",
                alpha: 0,
                ease: Elastic.easeOut.config(1, .3)
            });
        },
        onEnterCompleted: function() {},
        onLeave: function() {
            console.log("leave");
            TweenMax.to("#main-content", 1, {
                x: "-=100",
                alpha: 0
            });
        },
        onLeaveCompleted: function() {}
    });
    var About = Barba.BaseView.extend({
        namespace: "about",
        onEnter: function() {
            console.log("enter");
            TweenMax.from("#main-content", 1, {
                delay: .5,
                x: "+=100",
                alpha: 0,
                ease: Elastic.easeOut.config(1, .3)
            });
        },
        onEnterCompleted: function() {},
        onLeave: function() {
            console.log("leave");
            TweenMax.to("#main-content", 1, {
                x: "-=100",
                alpha: 0
            });
        },
        onLeaveCompleted: function() {}
    });
    Homepage.init();
    About.init();
}

function initBarba() {
    var FadeTransition = Barba.BaseTransition.extend({
        start: function() {
            Promise.all([ this.newContainerLoading, this.fadeOut() ]).then(this.fadeIn.bind(this));
        },
        fadeOut: function() {
            return $(this.oldContainer).animate({
                opacity: 0
            }).promise();
        },
        fadeIn: function() {
            var _this = this;
            var $el = $(this.newContainer);
            $(this.oldContainer).hide();
            $el.css({
                visibility: "visible",
                opacity: 0
            });
            $el.animate({
                opacity: 1
            }, 1e3, function() {
                _this.done();
            });
        }
    });
    Barba.Pjax.getTransition = function() {
        return FadeTransition;
    };
    handleAnimations();
    Barba.Pjax.cacheEnabled = false;
    Barba.Pjax.start();
}